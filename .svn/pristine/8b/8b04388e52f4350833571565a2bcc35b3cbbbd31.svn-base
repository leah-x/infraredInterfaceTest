<template>
  <div>
    <a-row type="flex"
           justify="start"
           align="middle"
           class="search">
      <a-col >
        <a-input-search
          placeholder="按照组名搜索"
          enter-button
          @search="onSearchByTaskGroupName" />
      </a-col>
      <a-col>
        <a-dropdown>
          <a-menu slot="overlay" @click="switchSortWay">
            <a-menu-item key="0"> <a-icon type="right" />{{sortWay[0]}}</a-menu-item>
            <a-menu-item key="1"> <a-icon type="right" />{{sortWay[1]}}</a-menu-item>
            <a-menu-item key="2"> <a-icon type="right" />{{sortWay[2]}}</a-menu-item>
            <a-menu-item key="3"> <a-icon type="right" />{{sortWay[3]}}</a-menu-item>
          </a-menu>
          <a-button style="margin-left: 8px"> {{currentWay}} <a-icon type="down" /> </a-button>
        </a-dropdown>
      </a-col>
    </a-row>
    <a-table
      style="margin-top: 8px"
      :columns="columns"
      :data-source="data"
      :pagination="false"
    >
      <span slot="action" slot-scope="text, record, index">
      <a @click="viewItem(record.groupId)" :disabled="record.state!==3">详情</a>
    </span>
    </a-table>
    <a-pagination
      style="margin-top: 8px"
      align="end"
      :defaultCurrent=1
      :defaultPageSize=10
      @change="simplePageChange"
      v-model="pageInfo.current"
      :total="pageInfo.total"
      show-less-items />
  </div>
</template>

<script>

const columns = [
  {
    title:'序号',
    dataIndex: 'index',
  },
  {
    title: '任务组名',
    dataIndex: 'groupName',
  },
  {
    title: '总任务数',
    dataIndex: 'numbers',
  },
  {
    title: '执行中',
    dataIndex: 'executingNumber',
  },
  {
    title: '已完成',
    dataIndex: 'finishNumber',
  },
  {
    title: '正常任务',
    dataIndex: 'abnormalNumber',
  },
  {
    title: '异常任务',
    dataIndex: 'unAbnormalNumber',
  },
  {
    title: '状态',
    dataIndex: 'state',
  },
  {
    title: '管理',
    key:'groupId',
    scopedSlots: { customRender: 'action' },
  },
];

import Diag from "../../netapi/diag"

export default {
  name: "TaskGroupDiagInfo",
  data(){
    return{
      columns,
      data:[],
      pageInfo:{
        current:1,
        size:10,
        total:50,
      },
      currentWay:"默认排序",
      sortWay:[
        "默认排序",
        "按照执行中任务数排序",
        "只看已完成的任务",
        "只看执行中的任务",
      ]
    }
  },
  methods:{
    viewItem(id){
      // 查看详情 跳转到任务组完成详情界面 todo
      console.log(id)
    },
    onSearchByTaskGroupName(value){

    },
    simplePageChange(page,pagesize){
      Diag.getTaskGroupDiagInfo({
        page: page,
        size: pagesize,
        userId: this.$cookies.get("loginId"),
      }).then(data=>{
        if (data.code==="200"){
          // 循环执行生成对象
          let result=JSON.parse(data.result);
          // 拼接分页对象
          this.stringPageInfo(result);
          // 抽取实际数组组合
          let list=result.list;
          for (let i = 0; i < list.length ; i++) {
            let bean=list[i];
            console.log(JSON.stringify(bean))
            this.data.push({
              index: i+1,
              groupId:bean.groupId,
              groupName:bean.groupName,
              numbers:bean.finishNumber+bean.executingNumber,
              executingNumber:bean.executingNumber,
              finishNumber:bean.finishNumber,
              abnormalNumber:bean.abnormalNumber,
              unAbnormalNumber: bean.finishNumber-bean.abnormalNumber,
              state: bean.state===1?"待处理":bean.state===2?"执行中":"已完成",
            });
          }
        }else{
          this.$message.info(data.message)
        }
      }).catch(err=>{
        this.$message.error(this.NETWORK_ERROR_MESSAGE);
        console.log(err)
      })
    },
    /**
     * 拼接分页对象
     * @param result
     */
    stringPageInfo(result){
      this.pageInfo.current=result.pageNum;
      this.pageInfo.size=result.pageSize;
      this.pageInfo.total=result.total;
    },
    /**
     * 切换任务排序方式
     * @param way 排序方式
     */
    switchSortWay(way){
      this.currentWay=this.sortWay[way.key];
    }

  },
  created() {
    // 进入此页面即获取页面数据
    this.simplePageChange(1,10)
  }
}
</script>

<style scoped>


</style>
